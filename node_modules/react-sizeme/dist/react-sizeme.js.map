{"version":3,"file":"react-sizeme.js","sources":["../src/resizeDetector.js","../src/sizeMe.js"],"sourcesContent":["import createResizeDetector from 'element-resize-detector'\n\nconst instances = {}\n\n// Lazily require to not cause bug\n// https://github.com/ctrlplusb/react-sizeme/issues/6\nfunction resizeDetector(strategy = 'scroll') {\n  if (!instances[strategy]) {\n    instances[strategy] = createResizeDetector({\n      strategy,\n    })\n  }\n\n  return instances[strategy]\n}\n\nexport default resizeDetector\n","/* eslint-disable react/no-multi-comp */\n/* eslint-disable react/require-default-props */\n\nimport React, { Children, Component } from 'react'\nimport PropTypes from 'prop-types'\nimport ReactDOM from 'react-dom'\nimport invariant from 'invariant'\nimport throttle from 'lodash.throttle'\nimport debounce from 'lodash.debounce'\nimport resizeDetector from './resizeDetector'\n\nconst defaultConfig = {\n  monitorWidth: true,\n  monitorHeight: false,\n  monitorPosition: false,\n  refreshRate: 16,\n  refreshMode: 'throttle',\n  noPlaceholder: false,\n  resizeDetectorStrategy: 'scroll',\n}\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component'\n}\n\n/**\n * This is a utility wrapper component that will allow our higher order\n * component to get a ref handle on our wrapped components html.\n * @see https://gist.github.com/jimfb/32b587ee6177665fb4cf\n */\nclass ReferenceWrapper extends Component {\n  static displayName = 'SizeMeReferenceWrapper'\n\n  render() {\n    return Children.only(this.props.children)\n  }\n}\nReferenceWrapper.propTypes = { children: PropTypes.element.isRequired }\n\nfunction Placeholder({ className, style }) {\n  // Lets create the props for the temp element.\n  const phProps = {}\n\n  // We will use any provided className/style or else make the temp\n  // container take the full available space.\n  if (!className && !style) {\n    phProps.style = { width: '100%', height: '100%' }\n  } else {\n    if (className) {\n      phProps.className = className\n    }\n    if (style) {\n      phProps.style = style\n    }\n  }\n\n  return <div {...phProps} />\n}\nPlaceholder.displayName = 'SizeMePlaceholder'\nPlaceholder.propTypes = {\n  className: PropTypes.string,\n  style: PropTypes.object,\n}\n\n/**\n * As we need to maintain a ref on the root node that is rendered within our\n * SizeMe component we need to wrap our entire render in a sub component.\n * Without this, we lose the DOM ref after the placeholder is removed from\n * the render and the actual component is rendered.\n * It took me forever to figure this out, so tread extra careful on this one!\n */\nconst renderWrapper = WrappedComponent => {\n  function SizeMeRenderer(props) {\n    const {\n      explicitRef,\n      className,\n      style,\n      size,\n      disablePlaceholder,\n      onSize,\n      ...restProps\n    } = props\n\n    const noSizeData =\n      size == null ||\n      (size.width == null && size.height == null && size.position == null)\n\n    const renderPlaceholder = noSizeData && !disablePlaceholder\n\n    const renderProps = {\n      className,\n      style,\n    }\n\n    if (size != null) {\n      renderProps.size = size\n    }\n\n    const toRender = renderPlaceholder ? (\n      <Placeholder className={className} style={style} />\n    ) : (\n      <WrappedComponent {...renderProps} {...restProps} />\n    )\n\n    return <ReferenceWrapper ref={explicitRef}>{toRender}</ReferenceWrapper>\n  }\n\n  SizeMeRenderer.displayName = `SizeMeRenderer(${getDisplayName(\n    WrappedComponent,\n  )})`\n\n  SizeMeRenderer.propTypes = {\n    explicitRef: PropTypes.func.isRequired,\n    className: PropTypes.string,\n    style: PropTypes.object, // eslint-disable-line react/forbid-prop-types\n    size: PropTypes.shape({\n      width: PropTypes.number, // eslint-disable-line react/no-unused-prop-types\n      height: PropTypes.number, // eslint-disable-line react/no-unused-prop-types\n    }),\n    disablePlaceholder: PropTypes.bool,\n    onSize: PropTypes.func,\n  }\n\n  return SizeMeRenderer\n}\n\n/**\n * :: config -> Component -> WrappedComponent\n *\n * Higher order component that allows the wrapped component to become aware\n * of it's size, by receiving it as an object within it's props.\n *\n * @param  monitorWidth\n *   Default true, whether changes in the element's width should be monitored,\n *   causing a size property to be broadcast.\n * @param  monitorHeight\n *   Default false, whether changes in the element's height should be monitored,\n *   causing a size property to be broadcast.\n *\n * @return The wrapped component.\n */\nfunction sizeMe(config = defaultConfig) {\n  const {\n    monitorWidth = defaultConfig.monitorWidth,\n    monitorHeight = defaultConfig.monitorHeight,\n    monitorPosition = defaultConfig.monitorPosition,\n    refreshRate = defaultConfig.refreshRate,\n    refreshMode = defaultConfig.refreshMode,\n    noPlaceholder = defaultConfig.noPlaceholder,\n    resizeDetectorStrategy = defaultConfig.resizeDetectorStrategy,\n  } = config\n\n  invariant(\n    monitorWidth || monitorHeight || monitorPosition,\n    'You have to monitor at least one of the width, height, or position when using \"sizeMe\"',\n  )\n\n  invariant(\n    refreshRate >= 16,\n    \"It is highly recommended that you don't put your refreshRate lower than \" +\n      '16 as this may cause layout thrashing.',\n  )\n\n  invariant(\n    refreshMode === 'throttle' || refreshMode === 'debounce',\n    'The refreshMode should have a value of \"throttle\" or \"debounce\"',\n  )\n\n  const refreshDelayStrategy = refreshMode === 'throttle' ? throttle : debounce\n\n  const detector = resizeDetector(resizeDetectorStrategy)\n\n  return function WrapComponent(WrappedComponent) {\n    const SizeMeRenderWrapper = renderWrapper(WrappedComponent)\n\n    class SizeAwareComponent extends React.Component {\n      static displayName = `SizeMe(${getDisplayName(WrappedComponent)})`\n\n      static propTypes = {\n        onSize: PropTypes.func,\n      }\n\n      state = {\n        width: undefined,\n        height: undefined,\n        position: undefined,\n      }\n\n      componentDidMount() {\n        this.determineStrategy(this.props)\n        this.handleDOMNode()\n      }\n\n      componentWillReceiveProps(nextProps) {\n        this.determineStrategy(nextProps)\n      }\n\n      componentDidUpdate() {\n        this.handleDOMNode()\n      }\n\n      componentWillUnmount() {\n        // Change our size checker to a noop just in case we have some\n        // late running events.\n        this.hasSizeChanged = () => undefined\n        this.checkIfSizeChanged = () => undefined\n\n        if (this.domEl) {\n          detector.uninstall(this.domEl)\n          this.domEl = null\n        }\n      }\n\n      determineStrategy = props => {\n        if (props.onSize) {\n          if (!this.callbackState) {\n            this.callbackState = {\n              ...this.state,\n            }\n          }\n          this.strategy = 'callback'\n        } else {\n          this.strategy = 'render'\n        }\n      }\n\n      strategisedSetState = state => {\n        if (this.strategy === 'callback') {\n          this.callbackState = state\n          this.props.onSize(state)\n        } else {\n          this.setState(state)\n        }\n      }\n\n      strategisedGetState = () =>\n        this.strategy === 'callback' ? this.callbackState : this.state\n\n      handleDOMNode() {\n        const found =\n          this.element &&\n          // One day this will be deprecated then I will be forced into wrapping\n          // the component with a div or such in order to get a dome element handle.\n          ReactDOM.findDOMNode(this.element) // eslint-disable-line react/no-find-dom-node\n\n        if (!found) {\n          // This is for special cases where the element may be null.\n          if (this.domEl) {\n            detector.uninstall(this.domEl)\n            this.domEl = null\n          }\n          return\n        }\n\n        if (this.domEl) {\n          detector.uninstall(this.domEl)\n        }\n\n        this.domEl = found\n        detector.listenTo(this.domEl, this.checkIfSizeChanged)\n      }\n\n      refCallback = element => {\n        this.element = element\n      }\n\n      hasSizeChanged = (current, next) => {\n        const c = current\n        const n = next\n        const cp = c.position || {}\n        const np = n.position || {}\n\n        return (\n          (monitorHeight && c.height !== n.height) ||\n          (monitorPosition &&\n            (cp.top !== np.top ||\n              cp.left !== np.left ||\n              cp.bottom !== np.bottom ||\n              cp.right !== np.right)) ||\n          (monitorWidth && c.width !== n.width)\n        )\n      }\n\n      checkIfSizeChanged = refreshDelayStrategy(el => {\n        const {\n          width,\n          height,\n          right,\n          left,\n          top,\n          bottom,\n        } = el.getBoundingClientRect()\n\n        const next = {\n          width: monitorWidth ? width : null,\n          height: monitorHeight ? height : null,\n          position: monitorPosition ? { right, left, top, bottom } : null,\n        }\n\n        if (this.hasSizeChanged(this.strategisedGetState(), next)) {\n          this.strategisedSetState(next)\n        }\n      }, refreshRate)\n\n      render() {\n        const disablePlaceholder =\n          sizeMe.enableSSRBehaviour ||\n          sizeMe.noPlaceholders ||\n          noPlaceholder ||\n          this.strategy === 'callback'\n\n        const size = { ...this.state }\n\n        return (\n          <SizeMeRenderWrapper\n            explicitRef={this.refCallback}\n            size={this.strategy === 'callback' ? null : size}\n            disablePlaceholder={disablePlaceholder}\n            {...this.props}\n          />\n        )\n      }\n    }\n\n    SizeAwareComponent.WrappedComponent = WrappedComponent\n\n    return SizeAwareComponent\n  }\n}\n\n/**\n * Allow SizeMe to run within SSR environments.  This is a \"global\" behaviour\n * flag that should be set within the initialisation phase of your application.\n *\n * Warning: don't set this flag unless you need to as using it may cause\n * extra render cycles to happen within your components depending on the logic\n * contained within them around the usage of the `size` data.\n *\n * DEPRECATED: Please use the global disablePlaceholders\n */\nsizeMe.enableSSRBehaviour = false\n\n/**\n * Global configuration allowing to disable placeholder rendering for all\n * sizeMe components.\n */\nsizeMe.noPlaceholders = false\n\nexport default sizeMe\n"],"names":["instances","resizeDetector","strategy","createResizeDetector","defaultConfig","getDisplayName","WrappedComponent","displayName","name","ReferenceWrapper","Children","only","props","children","Component","propTypes","PropTypes","element","isRequired","Placeholder","className","style","phProps","width","height","React","string","object","renderWrapper","SizeMeRenderer","explicitRef","size","disablePlaceholder","onSize","restProps","noSizeData","position","renderPlaceholder","renderProps","toRender","func","shape","number","bool","sizeMe","config","monitorWidth","monitorHeight","monitorPosition","refreshRate","refreshMode","noPlaceholder","resizeDetectorStrategy","refreshDelayStrategy","throttle","debounce","detector","WrapComponent","SizeMeRenderWrapper","SizeAwareComponent","state","undefined","determineStrategy","callbackState","strategisedSetState","setState","strategisedGetState","refCallback","hasSizeChanged","current","next","c","n","cp","np","top","left","bottom","right","checkIfSizeChanged","el","getBoundingClientRect","handleDOMNode","nextProps","domEl","uninstall","found","findDOMNode","listenTo","enableSSRBehaviour","noPlaceholders"],"mappings":"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"}